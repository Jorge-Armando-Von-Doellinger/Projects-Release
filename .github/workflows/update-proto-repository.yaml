name: Copy Proto Files to grpc-proto-files Repo

on:
  push:
    paths:
      - '.github/workflows/copy-protos.yml'
      - 'HMS/HMS.MicroServices/**.proto'

jobs:
  copy-protos:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repositoary
      - name: Check out repository
        uses: actions/checkout@v2

      # Step 2: List the directories to ensure correct structure
      - name: List root directory
        run: ls -l

      - name: List HMS directory to ensure correct path
        run: ls -l HMS

      - name: List HMS/HMS.MicroServices directory
        run: ls -l HMS/HMS.MicroServices

      # Step 3: Find .proto files and copy them
      - name: Find .proto files
        run: |
          mkdir -p /tmp/protos
          find HMS/HMS.MicroServices -type f -name "*.proto" -exec cp {} /tmp/protos/

      # Step 4: Clone the grpc-proto-files repository
      - name: Clone grpc-proto-files repositoryes
        run: |
          git clone https://github.com/Jorge-Armando-Von-Doellinger/grpc-proto-files.git /tmp/grpc-proto-files
        continue-on-error: true

      # Step 5: Copy the proto files to grpc-proto-files repository
      - name: Copy proto files to grpc-proto-files repo
        run: |
          cp /tmp/protos/* /tmp/grpc-proto-files/
          cd /tmp/grpc-proto-files
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add .
          git commit -m "Add new .proto files"
          git push origin main

      # Step 6: Clean up
      - name: Clean up
        run: rm -rf /tmp/protos /tmp/grpc-proto-files
